import{t as g}from"./index-C_B8vjJv.js";import{_ as oe,u as le,a as ne,g as se,c as N,o as ce,r as h,A as i,d as ie,e as re,f as t,w as a,p as P,j as s,i as r,m as p,t as c,V as ue,z as E,x as y,v as M,y as S}from"./index-Dcr4vpJk.js";import{s as de}from"./tools-oCf4Tkyz.js";const me={class:"page-div"},pe={class:"card-header"},fe={style:{"margin-top":"20px"}},he={style:{"line-height":"50px"}},_e={style:{"line-height":"50px"}},ge={style:{"line-height":"50px"}},be={style:{"line-height":"50px"}},ve={class:"card-header"},ke=ue({name:"toolsBackup"}),we=Object.assign(ke,{setup(ye){const{t:o}=le(),{isMobile:x}=ne(),F=se(),q=N(()=>F.isDark),d=N(()=>F.language);ce(()=>{v()});const B=h(!1),T=h(!1),L=h([]),_=h({enable:!1,time:"00:00:00"}),V=h(0),v=()=>{g.backup.get().then(e=>{L.value=e.data.backupFiles,_.value=e.data.backupSetting,V.value=e.data.diskUsage})},$=()=>{if(!_.value.time){E(o("tools.backup.timeChangeTip"));return}B.value=!0,T.value=!0;const e={time:_.value.time,enable:_.value.enable};g.backup.put(e).then(l=>{y(l.message)}).finally(()=>{B.value=!1,T.value=!1})},j=e=>{M.confirm(d.value==="zh"?"将执行删除操作，是否继续？":"The DELETE operation will be performed. Do you want to continue?",d.value==="zh"?"请确认您的操作":"Please confirm your operation",{confirmButtonText:d.value==="zh"?"确定":"confirm",cancelButtonText:d.value==="zh"?"取消":"cancel",type:"warning",beforeClose:(l,n,u)=>{if(l==="confirm"){n.confirmButtonLoading=!0;const f={name:e.name};g.backup.delete(f).then(k=>{y(k.message),u()}).catch(()=>{}).finally(()=>{n.confirmButtonLoading=!1,v()})}else u()}}).then(()=>{}).catch(()=>{S(o("home.canceled"))}).finally(()=>{b.value=!1})},A=e=>{M.confirm(d.value==="zh"?"将执行恢复操作，是否继续？":"The RESTORE operation will be performed. Do you want to continue?",d.value==="zh"?"请确认您的操作":"Please confirm your operation",{confirmButtonText:d.value==="zh"?"确定":"confirm",cancelButtonText:d.value==="zh"?"取消":"cancel",type:"warning",beforeClose:(l,n,u)=>{if(l==="confirm"){n.confirmButtonLoading=!0;const f={name:e.name};g.backupRestore.post(f).then(k=>{y(k.message),u()}).catch(()=>{}).finally(()=>{n.confirmButtonLoading=!1,v()})}else u()}}).then(()=>{}).catch(()=>{S(o("home.canceled"))}).finally(()=>{b.value=!1})},H=()=>{if(z.value.length===0){E(o("tools.backup.deleteTip"));return}M.confirm(d.value==="zh"?"将执行删除操作，是否继续？":"The DELETE operation will be performed. Do you want to continue?",d.value==="zh"?"请确认您的操作":"Please confirm your operation",{confirmButtonText:d.value==="zh"?"确定":"confirm",cancelButtonText:d.value==="zh"?"取消":"cancel",type:"warning",beforeClose:(e,l,n)=>{if(e==="confirm"){l.confirmButtonLoading=!0;const u={names:[]};for(let f of z.value)u.names.push(f.name);g.multiDelete.delete(u).then(f=>{y(f.message),n()}).catch(()=>{}).finally(()=>{l.confirmButtonLoading=!1,v()})}else n()}}).then(()=>{}).catch(()=>{S(o("home.canceled"))})},O=h(),z=h([]),G=e=>{z.value=e},K=e=>{if(e===0)return"0 B";const l=1024,n=["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],u=Math.floor(Math.log(e)/Math.log(l));return parseFloat((e/Math.pow(l,u)).toFixed(2))+" "+n[u]},Y=e=>{g.backupDownload.post({filename:e.name}).then(async l=>{await de(l.data,e.name)}).finally(()=>{b.value=!1})},b=h(!1),Z=e=>{let l=e.cmd,n=e.row;switch(b.value=!0,l){case"download":Y(n);break;case"restore":A(n);break;case"delete":j(n);break;default:b.value=!1,E("error")}},C=h(!1),J=()=>{C.value=!0,g.backup.post().then(e=>{y(e.message)}).finally(()=>{C.value=!1,v()})};return(e,l)=>{const n=i("el-button"),u=i("el-progress"),f=i("el-time-picker"),k=i("el-switch"),Q=i("el-alert"),R=i("el-card"),I=i("el-col"),w=i("el-table-column"),W=i("arrow-down"),X=i("el-icon"),D=i("el-dropdown-item"),ee=i("el-dropdown-menu"),te=i("el-dropdown"),ae=i("el-table"),U=i("el-row");return ie(),re("div",me,[t(U,{gutter:10},{default:a(()=>[t(I,{lg:12,md:12,sm:24,span:24,xs:24,style:{"margin-top":"10px"}},{default:a(()=>[t(R,{style:P(s(x)?"min-height: 500px":"min-height: 700px"),shadow:"never"},{header:a(()=>[r("div",pe,[p(c(s(o)("tools.backup.title1"))+" ",1),t(n,{type:"primary",onClick:J,loading:C.value},{default:a(()=>[p(c(s(o)("tools.backup.BackupImmediately")),1)]),_:1},8,["loading"])])]),default:a(()=>[r("div",null,[t(u,{percentage:parseFloat(V.value.toFixed(1))},{default:a(({percentage:m})=>[r("span",null,c(s(o)("tools.backup.processBar"))+c(m)+"%",1)]),_:1},8,["percentage"])]),r("div",fe,[r("div",he,[r("span",null,c(s(o)("tools.backup.text1")),1),t(f,{modelValue:_.value.time,"onUpdate:modelValue":l[0]||(l[0]=m=>_.value.time=m),loading:B.value,style:{width:"120px",margin:"0 8px"},clearable:!1,editable:!1,"value-format":"HH:mm:ss",onChange:$},null,8,["modelValue","loading"]),r("span",null,c(s(o)("tools.backup.text2")),1)]),r("div",_e,[r("span",null,c(s(o)("tools.backup.text3")),1),t(k,{modelValue:_.value.enable,"onUpdate:modelValue":l[1]||(l[1]=m=>_.value.enable=m),loading:T.value,"active-text":e.$t("tools.backup.switchEnable"),"inactive-text":e.$t("tools.backup.switchDisable"),"inline-prompt":"",onChange:$,style:{margin:"0 8px","--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue","loading","active-text","inactive-text"])]),r("div",ge,[r("span",null,c(s(o)("tools.backup.text4")),1)]),r("div",be,[r("span",null,c(s(o)("tools.backup.text5")),1)])]),t(Q,{effect:q.value?"light":"dark",type:"warning",closable:!1,style:{"margin-top":"20px"}},{default:a(()=>[p(c(s(o)("tools.backup.alert")),1)]),_:1},8,["effect"])]),_:1},8,["style"])]),_:1}),t(I,{lg:12,md:12,sm:24,span:24,xs:24,style:{"margin-top":"10px"}},{default:a(()=>[t(R,{style:P(s(x)?"min-height: 500px":"min-height: 700px"),shadow:"never"},{header:a(()=>[r("div",ve,[p(c(s(o)("tools.backup.title2"))+" ",1),t(n,{type:"danger",onClick:H},{default:a(()=>[p(c(s(o)("tools.backup.multiDelete")),1)]),_:1})])]),default:a(()=>[r("div",null,[t(U,null,{default:a(()=>[t(ae,{ref_key:"tableRef",ref:O,data:L.value,border:"",onSelectionChange:G,"max-height":s(x)?450:550},{default:a(()=>[t(w,{type:"selection",width:"55",fixed:"left"}),t(w,{label:e.$t("tools.backup.tableName"),prop:"name"},null,8,["label"]),t(w,{label:e.$t("tools.backup.size"),prop:"size"},{default:a(m=>[p(c(K(m.row.size)),1)]),_:1},8,["label"]),t(w,{label:e.$t("tools.backup.tableCreateTime"),prop:"createTime"},null,8,["label"]),t(w,{prop:"actions",label:e.$t("setting.button.actions"),width:"120px"},{default:a(m=>[t(te,{onCommand:Z,trigger:"click"},{dropdown:a(()=>[t(ee,null,{default:a(()=>[t(D,{command:{cmd:"download",row:m.row}},{default:a(()=>[p(c(s(o)("tools.backup.download")),1)]),_:2},1032,["command"]),t(D,{command:{cmd:"restore",row:m.row}},{default:a(()=>[p(c(s(o)("tools.backup.restore")),1)]),_:2},1032,["command"]),t(D,{command:{cmd:"delete",row:m.row}},{default:a(()=>[p(c(s(o)("tools.backup.delete")),1)]),_:2},1032,["command"])]),_:2},1024)]),default:a(()=>[t(n,{type:"primary",link:"",loading:b.value},{default:a(()=>[p(c(s(o)("setting.button.actions")),1),t(X,{class:"el-icon--right"},{default:a(()=>[t(W)]),_:1})]),_:1},8,["loading"])]),_:2},1024)]),_:1},8,["label"])]),_:1},8,["data","max-height"])]),_:1})])]),_:1},8,["style"])]),_:1})]),_:1})])}}}),ze=oe(we,[["__scopeId","data-v-f083da3d"]]);export{ze as default};
